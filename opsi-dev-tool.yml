locale:
  languages:
    - de
    - fr
  source_files:
    - opsiclientd

pyinstaller-poetry:
  update_version_in:
    - opsiclientd/__init__.py
  one_file: no
  hidden_imports:
    all:
      - csv
    windows:
      - pythoncom
      - win32api
      - win32timezone
    linux: []
    darwin: []
  scripts:
    - script: run-opsiclientd
      binaries:
        - opsiclientd
        - opsiclientd_rpc
        - action_processor_starter
  before_script:
    - url=$(git remote -v | grep fetch | cut -f2 | sed s'#/opsiclientd.git.*#/opsi-server.git#')
    #- branch=$(git rev-parse --abbrev-ref HEAD)
    - branch=master
    - GIT_TERMINAL_PROMPT=0 git clone --branch $branch $url
  data_files:
    # from opsiclientd
    - src: opsiclientd_data/common/static_html/*
      dst: opsiclientd_data/static_html/
    - src: opsiclientd_data/${PLATFORM_SYSTEM}/*
      dst: opsiclientd_data/
    # from opsi-server
    - src: opsi-server/opsi-server_data/etc/backendManager/extend.d/10_opsi.conf
      dst: opsiclientd_data/extend.d/10_opsi.conf
    - src: opsi-server/opsi-server_data/etc/backendManager/extend.d/20_legacy.conf
      dst: opsiclientd_data/extend.d/20_legacy.conf
  dirname: opsiclientd
  locale_install: opsiclientd_data/locale
  after_script:
    linux:
      - rm -r dist/opsiclientd/site-packages/Crypto/SelfTest
    darwin:
      - rm -r dist/opsiclientd/site-packages/Crypto/SelfTest
    windows:
      - Remove-Item -Force -Recurse -Path dist\opsiclientd\site-packages\Crypto\SelfTest

changelog:
  4.2.0.0:
    - Ported to python3
    - Switched to pyinstaller for packaging
    - Timeline fetches data using ajax calls and is auto updated every 5 seconds

