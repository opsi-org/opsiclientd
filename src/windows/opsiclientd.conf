; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
; =     configuration file for opsiclientd                              =
; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =


; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     global settings                                                 -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[global]

# Location of the log file.
log_file = c:\\tmp\\opsiclientd.log

# Set the log (verbosity) level
# (0 <= log level <= 9)
# 0: nothing, 1: critical, 2: errors, 3: warnings, 4: notices
# 5: infos, 6: debug messages, 7: more debug messages, 9: passwords
log_level = 4

# Opsi host key.
opsi_host_key = 

# On every daemon startup the user login gets blocked
# If the gui starts up and no events are being processed the login gets unblocked
# If no gui startup is noticed after <wait_for_gui_timeout> the login gets unblocked
# Set to 0 to wait forever
wait_for_gui_timeout = 120

# Time in seconds to wait before a required reboot is executed
# wait_before_reboot = 3

# Time in seconds to wait before a required shutdown is executed
# wait_before_shutdown = 3

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     config service settings                                         -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[config_service]
# Opsi server id
server_id =

# Service url.
# http(s)://<opsi config server address>:<port>/rpc
url = https://opsi.uib.local:4447/rpc

# Conection timeout.
connection_timeout = 10

# The time in seconds after which the user can cancel the connection establishment
user_cancellable_after = 10

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     depot server settings                                           -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[depot_server]

# Depot server id
depot_id =

# Depot url.
# smb://<depot address>/<share name>/<path to products>
url =

# Local depot drive
drive =

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     cache service settings                                          -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[cache_service]

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     control server settings                                         -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[control_server]

# The network interfaces to bind to.
# This must be the IP address of an network interface.
# Use 0.0.0.0 to listen to all interfaces
interface = 0.0.0.0

# The port where opsiclientd will listen for HTTPS rpc requests.
port = 4441

# The location of the server certificate.
ssl_server_cert_file = %system.program_files_dir%\\opsi.org\\preloginloader\\opsiclientd\\opsiclientd.pem

# The location of the server private key
ssl_server_key_file = %system.program_files_dir%\\opsi.org\\preloginloader\\opsiclientd\\opsiclientd.pem

# The location of the static files
static_dir = %system.program_files_dir%\\opsi.org\\preloginloader\\opsiclientd\\static_html

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     notification server settings                                    -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[notification_server]

# The network interfaces to bind to.
# This must be the IP address of an network interface.
# Use 0.0.0.0 to listen to all interfaces
interface = 127.0.0.1

# The port where opsiclientd will listen for notification clients.
port = 4442

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     opsiclientd notifier settings                                   -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[opsiclientd_notifier]

# Notifier application command
command = %system.program_files_dir%\\opsi.org\\preloginloader\\notifier.exe -p %notification_server.port%

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     opsiclientd rpc tool settings                                   -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[opsiclientd_rpc]

# RPC tool command
command = %system.program_files_dir%\\opsi.org\\preloginloader\\opsiclientd_rpc.exe "%global.host_id%" "%global.opsi_host_key%" "%control_server.port%"

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     action processor settings                                       -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[action_processor]
# Locations of action processor
local_dir = %system.program_files_dir%\\opsi.org\\preloginloader\\opsi-winst
remote_dir = \\install\\opsi-winst\\files\\opsi-winst
filename = winst32.exe
# Action processor command
command = "%action_processor.local_dir%\\%action_processor.filename%" /opsiservice "https://%config_service.host%:%config_service.port%" /clientid %global.host_id% /username %global.host_id% /password %global.opsi_host_key%

; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
; -     events                                                          -
; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[event_daemon_startup]
type = daemon startup
active = false

[event_daemon_shutdown]
type = daemon shutdown
active = false

[event_gui_startup]
type = gui startup
message = Starting to process product actions. Attention: the computer may restart. Please save all unsaved data now.
user_cancelable = false
block_login = true
lock_workstation = false
logoff_current_user = false
get_config_from_service = true
update_config_file = true
write_log_to_service = true
update_action_processor = true
cache_products = false
cache_max_bandwidth = 0
event_notifier_command = %opsiclientd_notifier.command% -s notifier\\event.ini
event_notifier_desktop = current
action_notifier_command = %opsiclientd_notifier.command% -s notifier\\action.ini
action_notifier_desktop = current
action_processor_command = %action_processor.command%
action_processor_desktop = current

[event_vpn_startup]
type = custom
active = false
wql = SELECT * FROM __InstanceModificationEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_NetworkAdapter' AND TargetInstance.Name = "TAP-Win32 Adapter V9" AND TargetInstance.NetConnectionStatus = 2
message = Opsi will start software and hardware inventory on this computer. You can continue your work in the meantime.
get_config_from_service = true
update_config_file = true
write_log_to_service = true
warning_time = 20
service_options = { "actionProcessingFilter": { "productIds": ["hwaudit", "swaudit"] } }
cache_products = false
cache_max_bandwidth = 0
event_notifier_command = %opsiclientd_notifier.command% -s notifier\\event.ini
event_notifier_desktop = current
action_notifier_command = %opsiclientd_notifier.command% -s notifier\\action.ini
action_notifier_desktop = current
action_processor_command = %action_processor.command% /service_options "%event_vpn_startup.service_options%"
action_processor_desktop = current

